<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Event Details</title>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
  </head>
  <body class="container mt-5">
    <div class="card p-4 shadow">
      <!-- Event Name -->
      <h2 class="text-primary" th:text="${event.name}">Event Name</h2>

      <!-- Back to Group Button -->
      <div class="mb-3">
        <a
          th:href="@{'/groups/' + ${event.group.id} + '/details?username=' + ${user.userName}}"
          class="btn btn-secondary"
          >Back to Group</a
        >
      </div>

      <!-- Event Description -->
      <p class="mb-4" th:text="${event.description}">Event Description</p>

      <!-- Event Status -->
      <p class="mb-2">
        <strong>Status:</strong> <span th:text="${event.status}">Status</span>
      </p>

      <!-- Event Creator -->
      <p class="mb-2">
        <strong>Created by:</strong>
        <span
          th:text="${event.creator != null ? event.creator.userName : 'Unknown'}"
          >Username</span
        >
      </p>

      <!-- Event Date -->
      <p class="mb-4">
        <strong>Date:</strong>
        <span
          th:text="${event?.getDate() != null ? #temporals.format(event.getDate(), 'yyyy-MM-dd HH:mm') : 'No Date Available'}"
        >
          Event Date
        </span>
      </p>

      <!-- Event Photo Display -->
      <div th:if="${event.photoPath}" class="mb-4">

        <div th:if="${!isParticipant}">
            <p>You must join this event to see attendance details.</p>
            <form action="/events/${event.id}/join" method="post">
                <input type="hidden" name="username" value="${user.username}" />
                <button type="submit">Join Event</button>
            </form>
        </div>
                <h4>Event Photo</h4>
        <img
          th:src="@{${event.photoPath}}"
          alt="Event Photo"
          class="img-fluid rounded"
        />
      </div>

      <div>
				<form th:action="@{'/events/' + ${event.id} + '/attendance?username=' + ${user.userName}}" 
									method="post"
									class="mt-4"
				>
          <label for="attendance">Attendance:</label>
          <select name="attendance" id="attendance">
              <option value="GOING">Going</option>
              <option value="MAYBE_GOING">Maybe Going</option>
              <option value="NOT_GOING">Not Going</option>
          </select>
          <input type="hidden" name="eventId" value="${event.id}" />
          <button type="submit">Submit</button>
        </form>
      
        <p>Current Attendance Status: <span th:text="${event.attendance}"></span></p>
      </div>

      <!-- Participating Users Section -->
      <h4 class="mt-4">Participants</h4>
      <p th:if="${event.participants.size() == 0}" class="text-muted">
        No participants yet.
      </p>
      <ul
        class="list-group mb-4"
        th:each="participant : ${event.participants}"
        th:if="${event.participants.size() > 0}"
      >
        <li class="list-group-item" th:text="${participant.userName}">
          Participant Username
        </li>
      </ul>

      <!-- Comments Section -->
      <h4 class="mt-4">Comments</h4>
      <div th:if="${event.comments.size() == 0}" class="text-muted mb-3">

        <div th:if="${!isParticipant}">
            <p>You must join this event to see attendance details.</p>
            <form action="/events/${event.id}/join" method="post">
                <input type="hidden" name="username" value="${user.username}" />
                <button type="submit">Join Event</button>
            </form>
        </div>
                No comments yet.
      </div>
      <div
        th:each="comment : ${event.comments}"
        class="mb-3 border-bottom pb-2"
      >
        <p>
          <strong
            th:text="${comment.author != null ? comment.author.userName : 'Anonymous'}"
            >Author</strong
          >:
          <span
						th:text="${(event?.getDate() != null ? #temporals.format(event.getDate(), 'yyyy-MM-dd HH:mm') : 'No Date Available') + ' ' + comment.commentData}"
          </span>
        </p>
      </div>

      <!-- Comment Form -->
      <form
        th:action="@{'/events/' + ${event.id} + '/details/comment'}"
        method="post"
        class="mt-4"
      >
        <input type="hidden" name="username" th:value="${user.userName}" />
        <div class="mb-3">
          <label for="commentData" class="form-label">Add a comment:</label>
          <textarea
            id="commentData"
            name="commentData"
            class="form-control"
            placeholder="Add a comment..."
            rows="3"
            required
          ></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Post Comment</button>
      </form>
    </div>

    <div th:if="${event.creator.userName == user.userName}" class="mt-4">

        <div th:if="${!isParticipant}">
            <p>You must join this event to see attendance details.</p>
            <form action="/events/${event.id}/join" method="post">
                <input type="hidden" name="username" value="${user.username}" />
                <button type="submit">Join Event</button>
            </form>
        </div>
              <form th:action="@{'/events/' + ${event.id} + '/delete'}" method="post">
        <input type="hidden" name="username" th:value="${user.userName}" />
        <button
          type="submit"
          class="btn btn-danger"
          onclick="return confirm('Are you sure you want to delete this event?');"
        >
          Delete Event
        </button>
      </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
