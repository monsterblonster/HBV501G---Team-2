<!doctype html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <head>
    <meta charset="UTF-8" />
    <title>User Profile</title>
  </head>
  <body>
    <div class="container mt-4">
      <h2>Welcome, <span th:text="${user.userName}"></span>!</h2>
      <a
        th:href="@{'/profile/edit?username=' + ${user.userName}}"
        class="btn btn-primary mb-3"
        >Edit Profile</a
      >

      <h3>Your Details:</h3>
      <table class="table table-bordered">
        <tr>
          <th>Full Name</th>
          <td th:text="${user.fullName}">John Doe</td>
        </tr>
        <tr>
          <th>Address</th>
          <td th:text="${user.address}">123 Main St, Anytown</td>
        </tr>
        <tr>
          <th>Phone Number</th>
          <td th:text="${user.phoneNumber}">123-456-7890</td>
        </tr>
        <tr>
          <th>Email Address</th>
          <td th:text="${user.emailAddress}">john.doe@example.com</td>
        </tr>
        <tr>
          <th>Username</th>
          <td th:text="${user.userName}">johndoe</td>
        </tr>
        <form
          th:action="@{/upload-picture}"
          method="post"
          enctype="multipart/form-data"
        >
          <input type="file" name="file" accept="image/*" required />
          <input type="hidden" name="username" th:value="${user.userName}" />
          <button type="submit" class="btn btn-primary">
            Upload New Picture
          </button>
        </form>
      </table>

      <h3>Your Groups:</h3>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Group Name</th>
            <th>Description</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr th:each="group : ${userGroups}">
            <td th:text="${group.groupName}">Group Name</td>
            <td th:text="${group.description}">Description</td>
            <td>
              <span
                th:each="tag : ${group.tags}"
                th:text="${tag.name}"
                class="badge badge-secondary mr-1"
              ></span>
            </td>
            <td>
              <a
                th:href="@{'/groups/' + ${group.id} + '/details?username=' + ${user.userName}}"
                class="btn btn-info btn-sm"
                >Details</a
              >
              <a
                th:href="@{'/groups/' + ${group.groupName} + '/events?username=' + ${user.userName}}"
                class="btn btn-primary btn-sm"
                >Events</a
              >
              <a
                th:href="@{'/profile/remove-group?username=' + ${user.userName} + '&groupId=' + ${group.id}}"
                onclick="return confirm('Are you sure you want to leave this group?')"
                class="btn btn-danger btn-sm"
                >Leave</a
              >
            </td>
          </tr>
        </tbody>
      </table>

      <h3>Pending Group Invitations</h3>
      <div th:if="${invitations.size() > 0}">
        <ul>
          <li th:each="invitation : ${invitations}">
            <span th:text="${invitation.group.groupName}">Group Name</span>
            <form
              th:action="@{'/invitations/' + ${invitation.id} + '/accept'}"
              method="post"
              style="display: inline"
            >
              <input
                type="hidden"
                name="username"
                th:value="${user.userName}"
              />
              <button type="submit" class="btn btn-sm btn-success">
                Accept
              </button>
            </form>
            <form
              th:action="@{'/invitations/' + ${invitation.id} + '/decline'}"
              method="post"
              style="display: inline"
            >
              <input
                type="hidden"
                name="username"
                th:value="${user.userName}"
              />
              <button type="submit" class="btn btn-sm btn-danger">
                Decline
              </button>
            </form>
          </li>
        </ul>
      </div>
      <p th:if="${invitations.size() == 0}">You have no pending invitations.</p>

      <h3>Create a New Group</h3>
      <a
        th:href="@{/create-group(username=${user.userName})}"
        class="btn btn-success"
        >Create Group</a
      >
    </div>
  </body>
</html>
